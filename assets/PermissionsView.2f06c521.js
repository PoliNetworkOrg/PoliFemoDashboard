import{l as P,H as y,I as j,J as w,K as S,o as a,e as l,h as e,t as c,L as x,k as h,A as f,x as m,w as _,m as C,M as I,N as B,v as N,y as T,z,i as A,B as u,O as b,F as p,D as v,P as O,j as L,G as U}from"./index.aaa1e316.js";const q=["","Politecnico di Milano"],g={authors:q},E={class:"border rounded"},M={class:"row"},V={class:"col-8"},D={class:"col ms-2 mt-1 text-truncate"},H=e("i",{class:"fas fa-user"},null,-1),F={key:0},R={key:1},G={class:"col-4"},J={class:"btn-group float-end"},K=e("i",{class:"fas fa-xmark"},null,-1),X=[K],Q={methods:{remove(){var o;var s=this.$el.querySelector("#btn-remove");if(s.classList.contains("pending")){s.classList.add("disabled"),s.classList.add("btn-list-item-action"),s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';var t={grant:this.grant,object_id:(o=this.objectid)!=null?o:null};h.delete(f+"/accounts/"+this.userid+"/permissions",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")},data:t}).then(()=>{this.emitter.emit("permission-deleted",t)}).catch(r=>{m.mainLogger.error("permessi","Error while revoking permission:"),m.mainLogger.error("permessi",r),_("Errore nella revoca del permesso: "+r.response.data.error,"error")}).finally(()=>{s.classList.remove("disabled"),s.classList.remove("pending"),s.classList.add("btn-list-item-action"),s.innerHTML='<i class="fas fa-xmark"></i>'})}else s.classList.add("pending"),s.classList.remove("btn-list-item-action"),s.innerHTML="Sicuro?"}}},W=Object.assign(Q,{__name:"PermissionListItem",props:{userid:{type:String,required:!0},objectid:{type:Number,required:!1},grant:{type:String,required:!0}},setup(s){return P.add(y,j,w,S),(t,o)=>(a(),l("div",E,[e("div",M,[e("div",V,[e("h5",D,[H,s.objectid?(a(),l("span",R," \xA0 "+c(s.grant)+" \u2022 "+c(x(g)[s.grant][s.objectid]),1)):(a(),l("span",F,"\xA0 "+c(s.grant),1))])]),e("div",G,[e("div",J,[e("button",{type:"button",id:"btn-remove",onClick:o[0]||(o[0]=(...r)=>t.remove&&t.remove(...r)),class:"btn btn-danger rounded-end btn-list-item-action"},X)])])])]))}});P.add(I,y,B);const Y={components:{PermissionListItem:W},data(){return{tempPermList:{},userid:"",autofill:{},filled:{}}},mounted(){this.autofill=g;const s=N();this.userid=s.userid,this.emitter.on("permissions-refreshed",()=>{T("permissions")||(this.$router.push("/"),_("Non hai i permessi per accedere alla pagina richiesta. Sei stato portato alla home.","error"))}),this.emitter.on("permission-deleted",t=>{this.tempPermList=this.tempPermList.filter(o=>o.grant!==t.grant&&o.object_id!==t.object_id)})},methods:{getPermissionsOfUser(){this.userid=$("#user-selected").val(),$("#permissions-loading").removeClass("d-none"),h.get(f+"/accounts/"+this.userid+"/permissions",{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(s=>{this.tempPermList=s.data.permissions}).catch(s=>{m.mainLogger.error("permissions",s)}).finally(()=>{$("#permissions-loading").addClass("d-none"),$("#new-perm-form").removeClass("d-none")})},addPermission(){$("#addpermbutton").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');const s=$("#added-perm").val();var t={grant:s};if(this.autofill.hasOwnProperty(s)){var o=0;g[s].forEach(r=>{r==$("#added-objid").val()?t.object_id=o:o++})}h.post(f+"/accounts/"+this.userid+"/permissions",t,{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(r=>{this.tempPermList.push(t)}).catch(r=>{m.mainLogger.error("permissions",r),_("Errore nell'aggiunta del permesso: "+r.response.data.error,"error")}).finally(()=>{$("#addpermbutton").html('<i class="fas fa-plus"></i>')})}}},Z=e("header",null,[e("meta",{charset:"utf-8"}),e("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})],-1),ee={class:"container mt-5"},se=e("div",{class:"alert alert-info",role:"alert"},[e("span",null,[e("i",{class:"fas fa-lg fa-circle-info"}),L(" Per la lista completa dei permessi e la loro descrizione, visita la "),e("a",{href:"https://google.com"},"documentazione"),L(". ")])],-1),te={key:0,class:"alert alert-danger",role:"alert"},ie=e("h4",{class:"alert-heading"},"Attenzione!",-1),oe=e("span",null,"Stai modificando i tuoi stessi permessi. Rimuovere quelli sbagliati potrebbe impedirti di accedere ad alcune pagine. ",-1),re=[ie,oe],ne={class:"row"},ae={class:"col-5"},le={class:"input-group mb-3"},de=e("span",{class:"input-group-text",id:"basic-addon1"},[e("i",{class:"fas fa-lg fa-user"})],-1),ce={class:"col-7"},me=e("div",{id:"permissions-loading",class:"spinner-border text-primary d-none",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),ue={class:"input-group mt-3 d-none",id:"new-perm-form"},pe={id:"added-objid",class:"form-control",placeholder:"id..."},he=e("i",{class:"fas fa-plus"},null,-1),fe=[he];function _e(s,t,o,r,n,d){const k=z("PermissionListItem");return a(),l(p,null,[Z,e("div",ee,[se,n.filled.userid==this.userid?(a(),l("div",te,re)):A("",!0),e("div",ne,[e("div",ae,[e("div",le,[de,u(e("input",{id:"user-selected",type:"text",class:"form-control",placeholder:"ID utente","onUpdate:modelValue":t[0]||(t[0]=i=>n.filled.userid=i),required:""},null,512),[[b,n.filled.userid]]),e("button",{class:"btn btn-secondary rounded-end",type:"button",onClick:t[1]||(t[1]=(...i)=>d.getPermissionsOfUser&&d.getPermissionsOfUser(...i))}," Cerca ")])]),e("div",ce,[me,(a(!0),l(p,null,v(n.tempPermList,i=>(a(),U(k,{key:i.id,objectid:i.object_id,grant:i.grant,userid:n.userid},null,8,["objectid","grant","userid"]))),128)),e("div",ue,[u(e("input",{id:"added-perm",type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>n.filled.grant=i),class:"form-control",placeholder:"Nuovo permesso"},null,512),[[b,n.filled.grant]]),u(e("select",pe,[(a(!0),l(p,null,v(n.autofill[n.filled.grant],i=>(a(),l("option",null,c(i),1))),256))],512),[[O,n.autofill.hasOwnProperty(n.filled.grant)]]),e("button",{id:"addpermbutton",class:"btn btn-success btn-list-item-action rounded-end",type:"button",onClick:t[3]||(t[3]=(...i)=>d.addPermission&&d.addPermission(...i))},fe)])])])])],64)}const be=C(Y,[["render",_e]]);export{be as default};
