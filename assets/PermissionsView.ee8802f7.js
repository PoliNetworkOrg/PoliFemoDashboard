import{l as P,C as y,D as j,E as w,G as S,o as a,e as l,g as e,t as c,j as h,A as f,v as m,s as _,k as x,H as C,I,u as B,w as T,x as A,h as E,J as u,K as g,F as p,y as b,L as N,i as v,B as U}from"./index.66111f6b.js";const z={class:"border rounded"},O={class:"row"},V={class:"col-8"},q={class:"col ms-2 mt-1 text-truncate"},M=e("i",{class:"fas fa-user"},null,-1),D={key:0},H={key:1},F={class:"col-4"},G={class:"btn-group float-end"},J=e("i",{class:"fas fa-xmark"},null,-1),K=[J],R={methods:{remove(){var n;var s=this.$el.querySelector("#btn-remove");if(s.classList.contains("pending")){s.classList.add("disabled"),s.classList.add("btn-list-item-action"),s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';var t={grant:this.grant,object_id:(n=this.objectid)!=null?n:null};h.delete(f+"/accounts/"+this.userid+"/permissions",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")},data:t}).then(()=>{this.emitter.emit("permission-deleted",t)}).catch(o=>{m.mainLogger.error("permessi","Error while revoking permission:"),m.mainLogger.error("permessi",o),_("Errore nella revoca del permesso: "+o.response.data.error,"error")}).finally(()=>{s.classList.remove("disabled"),s.classList.remove("pending"),s.classList.add("btn-list-item-action"),s.innerHTML='<i class="fas fa-xmark"></i>'})}else s.classList.add("pending"),s.classList.remove("btn-list-item-action"),s.innerHTML="Sicuro?"}}},X=Object.assign(R,{__name:"PermissionListItem",props:{userid:{type:String,required:!0},objectid:{type:Number,required:!1},grant:{type:String,required:!0}},setup(s){return P.add(y,j,w,S),(t,n)=>(a(),l("div",z,[e("div",O,[e("div",V,[e("h5",q,[M,s.objectid?(a(),l("span",H,"\xA0 "+c(s.grant)+" \u2022 "+c(this.$parent.autofill[s.grant][s.objectid]),1)):(a(),l("span",D,"\xA0 "+c(s.grant),1))])]),e("div",F,[e("div",G,[e("button",{type:"button",id:"btn-remove",onClick:n[0]||(n[0]=(...o)=>t.remove&&t.remove(...o)),class:"btn btn-danger rounded-end btn-list-item-action"},K)])])])]))}}),Q=["","Politecnico di Milano"],L={authors:Q};P.add(C,y,I);const W={components:{PermissionListItem:X},data(){return{tempPermList:{},userid:"",autofill:{},filled:{}}},mounted(){this.autofill=L,this.emitter.on("permissions-refreshed",()=>{const s=B();this.userid=s.userid,T("permissions")||(this.$router.push("/"),_("Non hai i permessi per accedere alla pagina richiesta. Sei stato portato alla home.","error"))}),this.emitter.on("permission-deleted",s=>{this.tempPermList=this.tempPermList.filter(t=>t.grant!==s.grant&&t.object_id!==s.object_id)})},methods:{getPermissionsOfUser(){this.userid=$("#user-selected").val(),$("#permissions-loading").removeClass("d-none"),h.get(f+"/accounts/"+this.userid+"/permissions",{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(s=>{this.tempPermList=s.data.permissions}).catch(s=>{m.mainLogger.error("permissions",s)}).finally(()=>{$("#permissions-loading").addClass("d-none"),$("#new-perm-form").removeClass("d-none")})},addPermission(){$("#addpermbutton").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');const s=$("#added-perm").val();var t={grant:s};if(this.autofill.hasOwnProperty(s)){var n=0;L[s].forEach(o=>{o==$("#added-objid").val()?t.object_id=n:n++})}h.post(f+"/accounts/"+this.userid+"/permissions",t,{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(o=>{this.tempPermList.push(t)}).catch(o=>{m.mainLogger.error("permissions",o),_("Errore nell'aggiunta del permesso: "+o.response.data.error,"error")}).finally(()=>{$("#addpermbutton").html('<i class="fas fa-plus"></i>')})}}},Y=e("header",null,[e("meta",{charset:"utf-8"}),e("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})],-1),Z={class:"container mt-5"},ee=e("div",{class:"alert alert-info",role:"alert"},[e("span",null,[e("i",{class:"fas fa-lg fa-circle-info"}),v(" Per la lista completa dei permessi e la loro descrizione, visita la "),e("a",{href:"https://google.com"},"documentazione"),v(".")])],-1),se={key:0,class:"alert alert-danger",role:"alert"},te=e("h4",{class:"alert-heading"},"Attenzione!",-1),ie=e("span",null,"Stai modificando i tuoi stessi permessi.",-1),oe=[te,ie],re={class:"row"},ne={class:"col-5"},ae={class:"input-group mb-3"},le=e("span",{class:"input-group-text",id:"basic-addon1"},[e("i",{class:"fas fa-lg fa-user"})],-1),de={class:"col-7"},ce=e("div",{id:"permissions-loading",class:"spinner-border text-primary d-none",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),me={class:"input-group mt-3 d-none",id:"new-perm-form"},ue={id:"added-objid",class:"form-control",placeholder:"id..."},pe=e("i",{class:"fas fa-plus"},null,-1),he=[pe];function fe(s,t,n,o,r,d){const k=A("PermissionListItem");return a(),l(p,null,[Y,e("div",Z,[ee,r.filled.userid==this.userid?(a(),l("div",se,oe)):E("",!0),e("div",re,[e("div",ne,[e("div",ae,[le,u(e("input",{id:"user-selected",type:"text",class:"form-control",placeholder:"ID utente","onUpdate:modelValue":t[0]||(t[0]=i=>r.filled.userid=i),required:""},null,512),[[g,r.filled.userid]]),e("button",{class:"btn btn-secondary rounded-end",type:"button",onClick:t[1]||(t[1]=(...i)=>d.getPermissionsOfUser&&d.getPermissionsOfUser(...i))},"Cerca")])]),e("div",de,[ce,(a(!0),l(p,null,b(r.tempPermList,i=>(a(),U(k,{key:i.id,objectid:i.object_id,grant:i.grant,userid:r.userid},null,8,["objectid","grant","userid"]))),128)),e("div",me,[u(e("input",{id:"added-perm",type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>r.filled.grant=i),class:"form-control",placeholder:"Nuovo permesso"},null,512),[[g,r.filled.grant]]),u(e("select",ue,[(a(!0),l(p,null,b(r.autofill[r.filled.grant],i=>(a(),l("option",null,c(i),1))),256))],512),[[N,r.autofill.hasOwnProperty(r.filled.grant)]]),e("button",{id:"addpermbutton",class:"btn btn-success btn-list-item-action rounded-end",type:"button",onClick:t[3]||(t[3]=(...i)=>d.addPermission&&d.addPermission(...i))},he)])])])])],64)}const ge=x(W,[["render",fe]]);export{ge as default};
