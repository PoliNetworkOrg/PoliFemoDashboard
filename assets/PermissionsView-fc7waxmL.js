import{l as y,K as k,L as w,M as S,N as T,o as n,e as a,h as s,t as m,O as x,k as g,A as f,p as u,s as _,q as C,P as q,Q as I,u as A,E as N,G as B,i as b,w as p,m as v,F as h,r as L,R as E,j as P,n as M}from"./index-JBmZ-adD.js";import{g as O}from"./Translations-e6u3VnUD.js";const U=["","Politecnico di Milano","PoliNetwork"],d={authors:U},z={class:"border rounded"},V={class:"row"},D={class:"col-8"},H={class:"col ms-2 mt-1 text-truncate","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"a"},R=s("i",{class:"fas fa-user"},null,-1),F={key:0},G={key:1},K={class:"col-4"},Q={class:"btn-group float-end"},X=s("i",{class:"fas fa-xmark"},null,-1),J=[X],W={mounted(){var e=this.$el.querySelector("h5");console.log(d[this.grant]?d[this.grant][this.objectid]:null),e.setAttribute("data-bs-title",O("permission_"+this.grant,d[this.grant]?d[this.grant][this.objectid]:null)),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(r=>new bootstrap.Tooltip(r))},methods:{remove(){var e=this.$el.querySelector("#btn-remove");if(e.classList.contains("pending")){e.classList.add("disabled"),e.classList.add("btn-list-item-action"),e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';var t={grant:this.grant,object_id:this.objectid??null};g.delete(f+"/accounts/"+this.userid+"/permissions",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")},data:t}).then(()=>{this.emitter.emit("permission-deleted",t)}).catch(r=>{u.mainLogger.error("permessi","Error while revoking permission:"),u.mainLogger.error("permessi",r),_("Errore nella revoca del permesso: "+r.response.data.error,"error")}).finally(()=>{e.classList.remove("disabled"),e.classList.remove("pending"),e.classList.add("btn-list-item-action"),e.innerHTML='<i class="fas fa-xmark"></i>'})}else e.classList.add("pending"),e.classList.remove("btn-list-item-action"),e.innerHTML="Sicuro?",setTimeout(()=>{this.stopPendingDeletion()},5e3)},stopPendingDeletion(){var e=this.$el.querySelector("#btn-remove");e.classList.remove("pending"),e.classList.add("btn-list-item-action"),e.innerHTML='<i class="fas fa-xmark"></i>'}}},Y=Object.assign(W,{__name:"PermissionListItem",props:{userid:{type:String,required:!0},objectid:{type:Number,required:!1},grant:{type:String,required:!0}},setup(e){return y.add(k,w,S,T),(t,r)=>(n(),a("div",z,[s("div",V,[s("div",D,[s("h5",H,[R,e.objectid?(n(),a("span",G,"  "+m(e.grant)+" • "+m(x(d)[e.grant][e.objectid]),1)):(n(),a("span",F,"  "+m(e.grant),1))])]),s("div",K,[s("div",Q,[s("button",{type:"button",id:"btn-remove",onClick:r[0]||(r[0]=(...l)=>t.remove&&t.remove(...l)),class:"btn btn-danger rounded-end btn-list-item-action"},J)])])])]))}});y.add(q,k,I);const Z={components:{PermissionListItem:Y},data(){return{tempPermList:{},autofill:{},filled:{},store:A()}},mounted(){this.autofill=d,this.emitter.on("permissions-refreshed",()=>{N("permissions")||(this.$router.push("/"),_("Non hai i permessi per accedere alla pagina richiesta. Sei stato portato alla home.","error"))}),this.emitter.on("permission-deleted",e=>{this.tempPermList=this.tempPermList.filter(t=>t.grant!==e.grant&&t.object_id!==e.object_id)})},methods:{getPermissionsOfUser(){this.tempPermList=[],$("#permissions-loading").removeClass("d-none"),g.get(f+"/accounts/"+this.filled.userid+"/permissions",{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(e=>{this.tempPermList=e.data.permissions}).catch(e=>{u.mainLogger.error("permissions",e),this.tempPermList=[]}).finally(()=>{$("#permissions-loading").addClass("d-none"),$("#new-perm-form").removeClass("d-none")})},addPermission(){$("#addpermbutton").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');const e=$("#added-perm").val();var t={grant:e};if(this.autofill.hasOwnProperty(e)){var r=0;d[e].forEach(l=>{l==$("#added-objid").val()?t.object_id=r:r++})}g.post(f+"/accounts/"+this.filled.userid+"/permissions",t,{headers:{Authorization:"Bearer "+localStorage.getItem("polifemo_access_token")}}).then(l=>{this.tempPermList.push(t)}).catch(l=>{u.mainLogger.error("permissions",l),_("Errore nell'aggiunta del permesso: "+l.response.data.error,"error")}).finally(()=>{$("#addpermbutton").html('<i class="fas fa-plus"></i>')})}}},ee=s("header",null,[s("meta",{charset:"utf-8"}),s("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})],-1),se={class:"container mt-5"},te=s("div",{class:"alert alert-info",role:"alert"},[s("span",null,[s("i",{class:"fas fa-lg fa-circle-info"}),P(" Per la lista completa dei permessi e la loro descrizione, visita la "),s("a",{href:"https://google.com"},"documentazione"),P(". ")])],-1),ie={key:0,class:"alert alert-danger",role:"alert"},oe=s("h4",{class:"alert-heading"},"Attenzione!",-1),re=s("span",null,"Stai modificando i tuoi stessi permessi. Rimuovere quelli sbagliati potrebbe impedirti di accedere ad alcune pagine. ",-1),ne=[oe,re],ae={class:"row"},le={class:"col-5"},de={class:"input-group mb-3"},ce=s("span",{class:"input-group-text",id:"basic-addon1"},[s("i",{class:"fas fa-lg fa-user"})],-1),me={class:"col-7"},ue=s("div",{id:"permissions-loading",class:"spinner-border text-primary d-none",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),pe={key:0,class:"mt-3"},he={class:"input-group d-none",id:"new-perm-form"},ge={id:"added-objid",class:"form-control",placeholder:"id..."},fe=s("i",{class:"fas fa-plus"},null,-1),_e=[fe];function be(e,t,r,l,o,c){const j=B("PermissionListItem");return n(),a(h,null,[ee,s("div",se,[te,o.filled.userid==this.store.userid?(n(),a("div",ie,ne)):b("",!0),s("div",ae,[s("div",le,[s("div",de,[ce,p(s("input",{id:"user-selected",type:"text",class:"form-control",placeholder:"ID utente","onUpdate:modelValue":t[0]||(t[0]=i=>o.filled.userid=i),required:""},null,512),[[v,o.filled.userid]]),s("button",{class:"btn btn-secondary rounded-end",type:"button",onClick:t[1]||(t[1]=(...i)=>c.getPermissionsOfUser&&c.getPermissionsOfUser(...i))}," Cerca ")])]),s("div",me,[ue,(n(!0),a(h,null,L(o.tempPermList,i=>(n(),M(j,{key:i.id,objectid:i.object_id,grant:i.grant,userid:o.filled.userid},null,8,["objectid","grant","userid"]))),128)),o.tempPermList.length!=0?(n(),a("div",pe)):b("",!0),s("div",he,[p(s("input",{id:"added-perm",type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>o.filled.grant=i),class:"form-control",placeholder:"Nuovo permesso"},null,512),[[v,o.filled.grant]]),p(s("select",ge,[(n(!0),a(h,null,L(o.autofill[o.filled.grant],i=>(n(),a("option",null,m(i),1))),256))],512),[[E,o.autofill.hasOwnProperty(o.filled.grant)]]),s("button",{id:"addpermbutton",class:"btn btn-success btn-list-item-action rounded-end",type:"button",onClick:t[3]||(t[3]=(...i)=>c.addPermission&&c.addPermission(...i))},_e)])])])])],64)}const Pe=C(Z,[["render",be]]);export{Pe as default};
